<ion-header [translucent]="true" ion-no-border="true">
  <ion-toolbar class="toolbar-color">
    <ion-title>
      Inventario
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <main class="main-content">
    <!-- Formulario de edición -->
    <div *ngIf="modoEdicion; else listaProductos" class="edit-form">
      <h2 class="section-title">Editar Producto</h2>
      <form (ngSubmit)="guardarCambios()">
        <ion-list>
          <!-- CAMPO OCULTO: id_formato -->
          <ion-item lines="none" style="display: none;">
            <ion-label position="stacked">ID Formato</ion-label>
            <ion-input
              [(ngModel)]="productoSeleccionado.id_formato"
              name="id_formato"
            ></ion-input>
          </ion-item>
          <!-- FIN CAMPO OCULTO -->

          <!-- Nombre del producto -->
          <ion-item>
            <ion-label position="stacked">Nombre del Producto</ion-label>
            <ion-input
              [(ngModel)]="productoSeleccionado.nombre_producto"
              name="nombre_producto"
              required
            ></ion-input>
          </ion-item>

          <!-- Categoría/Formato -->
          <ion-item>
            <ion-label position="stacked">Categoría</ion-label>
            <ion-input
              [(ngModel)]="productoSeleccionado.formato"
              name="formato"
              required
            ></ion-input>
          </ion-item>

          <!-- Cantidad -->
          <ion-item>
            <ion-label position="stacked">Cantidad</ion-label>
            <ion-input
              type="number"
              [(ngModel)]="productoSeleccionado.cantidad"
              name="cantidad"
              required
            ></ion-input>
          </ion-item>

          <!-- Precio -->
          <ion-item>
            <ion-label position="stacked">Precio</ion-label>
            <ion-input
              type="number"
              [(ngModel)]="productoSeleccionado.precio"
              name="precio"
              required
            ></ion-input>
          </ion-item>
        </ion-list>

        <!-- Botones de acción -->
        <ion-button expand="block" type="submit">Guardar Cambios</ion-button>
        <ion-button
          expand="block"
          color="medium"
          (click)="cancelarEdicion()"
        >
          Cancelar
        </ion-button>
      </form>
    </div>

    <!-- Lista de productos -->
    <ng-template #listaProductos>
      <div class="section-header">
        <h2 class="section-title">Inventario de Productos</h2>
      </div>

      <!-- Barra de búsqueda -->
      <ion-searchbar
        [(ngModel)]="searchQuery"
        placeholder="Buscar producto..."
      ></ion-searchbar>

      <button *ngIf="!modoEdicion" class="add-product-button" (click)="escanear_Productos_Nuevos()">
        <ion-icon name="add"></ion-icon>
        Agregar Productos / Buscar por BARRAS
      </button>  
      <br>

      <!-- Encabezado de la tabla -->
      <div class="product-list-header">
        <div class="header-name">Nombre</div>
        <div class="header-quantity">Cantidad</div>
        <div class="header-edit">Editar</div>
      </div>

      <!-- Filas de productos -->
      <ng-container *ngIf="filteredProducts.length > 0; else noProducts">
        <div
          *ngFor="let producto of filteredProducts; let i = index"
          [ngClass]="i % 2 === 0 ? 'product-row even' : 'product-row odd'"
        >
          <div class="product-info">
            <div class="product-image-wrapper">
              <img
                [src]="producto.imagen"
                class="product-image"
              />
            </div>
            <div class="product-text">
              <p class="product-name">{{ producto.nombre_producto }}</p>
              <p class="product-precio"> $:{{ producto.precio }}</p>
            </div>
          </div>
          <div class="product-quantity">
            <span class="badge">{{ producto.cantidad }}</span>
          </div>
          <div class="product-edit">
            <button
              class="icon-button edit-button"
              (click)="activarEdicion(producto)"
            >
            <ion-icon name="create-outline"></ion-icon>
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #noProducts>
        <div class="no-productos">No se encontraron productos</div>
      </ng-template>
    </ng-template>
  </main>
</ion-content>
